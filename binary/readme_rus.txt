                             Text Converter 1.01 beta
                             ------------------------
      Text Converter - программа позволяющая преобразовывать файлы (не
обязательно текстовые) путем последовательного применения к ним набора правил
типа "Заменить все вхождения А на В". Text Converter позволяет редактировать эти
наборы, созранять и загружать их из файлов на диске, а также применять текущий
набор к некоторому файлу.

      Помимо собственно правил, каждый набор может включать дополнительные
жестко определенные процедуры, которые необходимо применить к файлу перед и
после применения основных правил набора.

      Программа может применяться для формирования электронных книг
непостедственно на КПК Psion, а также для осуществления других стандартный 
преобразований файлов.

                          Редактирование набора правил
                          ----------------------------
      Открытие и сохранение наборов правил происходит аналогично открытию и
сохранению любых других документов с использованием следующих команд:

      Файл - Создать файл (Ctrl+N) - создать новый набор правил
      Файл - Открыть файл (Ctrl+N) - загрузить набор правил из файла
      Файл - Другое - Сохранить (Ctrl+S) - сохранить набор правил в файл
      Файл - Другое - Сохранить как (Ctrl+Shift+S) - сохранить набор правил
в новый файл
      Файл - Другое - Вернуться к сохраненному (Ctrl+R) - вернуться к состоянию,
сохраненному ранее

	Каждый набор правил имеет набор параметров, просмотреть и отредактировать
которые можно выбрав пункт меню Действия - Опции (Ctrl+K), или нажав на кнопку
Опции на панели справа. Этот набор параметров включает:

  Вкладка "Описание":
	Описание - произвольное текстовое описание набора правил

	Вкладка "Начало обработки":
	Обработать HTML - исходный документ находится в формате HTML и его необходимо
перевести в	текстовый формат
	Кодировка - тип кодировки, в которой изначально находится текстовый документ.
При	применении набора правил, документ переводится в кодировку Win-1251 (которую
используют все русификаторы для Psion). Если в поле стоит значение "<Авто>", то
программа определит	тип кодировки автоматически.
	Обрезать до - если эта строка присутстсвует во входном тексте, текст будет
обрезан от начала, до этой строки включительно
	Обрезать после - если эта строка присутстсвует во входном тексте, текст будет
обрезан от начала строки до конца файла

	Вкладка "Конец обработки":
	Выходная кодировка - тип кодировки, в которую будет преобразован выходной
документ. Если в поле стоит значение "<Авто>", то текст будет преобразован в
кодировку, в которой находился начальный документ.
	Конвертировать в TCR - после окончания обработки текст будет преобразован в
сжатый формат TCR

	Указанные выше инструкции выполняются в том порядке, в котором они указаны в
окне редактирования, то есть:
	1. Преобразование HTML в текст
	2. Выяснение входной кодировки
	3. Изменение входной кодировки
	4. Обрезка текста (за один проход обрезается и заголовок, и концевик текста)
	5. Применение основного набора правил
	6. Изменение выходной кодировки
	7. Преобразование в TCR

	Для подтверждения редактирования параметров набора правил необходимо нажать на
кнопку Ok (Enter), для отмены изменений - кнопку Cancel (Esc).

                             Редактирование правил
                             ---------------------
	Правила, вкдлюченные в набор отображаются в списке слева в том порядке в
котором они будут выполняться. Редактирование списка правил осуществляется
следующими командами:
	Правило - Добавить (Ctrl+A) - добавить новое правило в конец списка
	Правило - Вставить (Ctrl+I) - добавить новое правило перед текущим выбранным
правилом
	Правило - Изменить (Enter) - изменить текущее выбранное правило
	Правило - Удалить (Del) - удалить текущее выбранное правило
	Правило - Сдвинуть вверх (Ctrl+M) - поменять местами текущее и предыдущее
правило
	Правило - Сдвинуть вниз (Ctrl+Shift+M) - поменять местами текущее и
последующее правило

	При выборе команд Добавить, Вставить или Изменить появляется окно
редактирования правила. В этом окне для правила можно установить следующие
параметры:
	Имя правила - произвольная текстовая строка, описывающая назначение данного
правила
	Найти - подстрока для поиска в исходном тексте
	Заменить - подстрока для замены в исходном тексте
	Только слово целиком - указание на то, что правило можно применять к подстроке,
только если она окружена пробельными символами (пробел, символ табуляции,
перенос строки).
	С учетом регистра - указание на то, что при поиске необходимо учитывать
регистр.
	Повторять пока возможно - указание на то, что данное правило необходимо
применять до тех пор, пока в тексте присутствует искомая подстрока.
	В строках "Найти", "Заменить", "Обрезать до" и "Обрезать после" помимо обычных
символов могут присутствовать служебные последовательности, соответствующие
служебным символам в текстовом файле:
	'\n' - перевод строки (пара вимволов с кодами 0xD и 0xА). ВНИМАНИЕ! Данная
последовательность НЕ соответствует каждому символу 0xD и 0xА в отдельности,
несмотря на то, что в некоторых редакторах оба эти символа по отдельности могут
использоваться как символы перевода строки.
	'\t' - символ табуляции
	'\\' - символ \
	'\x**' - символ с данным 16-ричным кодом (** - двухзначный код символа от 00
до FF)
	'\***' - символ с данным десятичным кодом (*** - трехзначных код символа от
000 до 255)
	В коде всегда должно присутствовать 2 или 3 (соответсвенно) символов, то есть
символ с кодом 1 должен обозначаться как '\x01' или '\001', символ с десятичным
кодом 10 - '\x0A' или '\010' и т. д.

	Для подтверждения редактирования правила необходимо нажать на кнопку Ok
(Enter), для отмены изменений - кнопку Cancel (Esc).

                        Применение набора правил к файлу
                        --------------------------------
	Для применения набора правил к файлу необходимо выбрать команду Запуск в меню
Действия (Ctrl+C) или нажать на кнопку "Запуск" на панели справа. Одно за другим
появится 2 диалоговых окна, в которых необходимо указать путь к входному файлу и
путь к выходному файлу. Если в процессе конвертации возникнет ошибка или
конвертация была прервана пользователем, выходной файл будет удален вне
зависимости от того существовал ли он в момент начала конвертации. Оба файла
(источник и приемник) не должны использоваться другими приложениями во время
операции преобразования. Если нажать Cancel в любом из этих диалоговых окон,
конвертирование произведено не будет.
	После выбора выходного файла начнется собственно процесс конвертирования. На
экране появится диалоговое окно, в котором будет отображаться имя текущего этапа
конвертирования, а также информация о том какая часть текущего этапа уже
выполнена. Если текущим этапом является применение правила, то указывается номер
правила и номер текущего прохода (если у правила стоит флаг "Повторять пока
возможно" оно может выполняться в несколько проходов). Пользователь может в
любой момент прервать конвертацию файлов, в этом случае результирующий файл
будет удален.
	Процесс конвертирования требует объем памяти, в 2 раза превышающий объем
исходного файла (для выходного файла и для временного хранения данных в памяти
или во временном файле). В процессе конвертирования используется фиксированный
временный файл C:\System\Temp\TxtConv\temp.txt. Это позволяет не забивать диск
лишним мусором, образовывающимся, если в процессе работы произошла ошибка.
Данный файл (и папка TxtConv) создаются при установке программы и удаляются при
ее удалении через панель управления. Данный файл (но не папка!) может быть
удален, если не запущено ни одной копии программы. Вместе с тем, одновременный
запуск нескольких сеансов конвертирования (в нескольких параллельно запущенных
копиях программы) НЕВОЗМОЖЕН.
	В программе предусмотрен так называемый отладочный режим конвертирования,
предназначенный для проверки правильности текущего набора правил. Отладочный
режим имеет две особенности. Во-первых, перед началом каждого прохода по файлу
программа останавливается и для продолжения конвертирования необходимо нажать
кнопку Ok в окне конвертирования (или Cancel для его отмены). Во-вторых, после
завершения каждого прохода по файлу программа сохраняет промежуточный результат
в отладочный файл, путь к которому запрашивается дополнительно перед началом
конвертирования. Отладочный файл не должен использоваться другими приложениями,
путь к отладочному файлу не может совпадать с путем к входному или к выходному
файлам.

                             Примеры наборов правил
                             ----------------------
	В данном архиве содержится два набора правил, которые могут использоваться с
программой. Первый набор правил ("HTML Moshkov") форматирует электронные книги,
находящиеся в формате HTML и сжимает их в TCR. Набор может применяться к книгам,
лежащим в библиотеке Мошкова (www.lib.ru), хотя вероятнее всего не ко всем
(разные книги имеют разный формат).
  Набор производит следующие действия:
  - преобазует HTML в текст
  - удаляет текст до "gZipLib.ru html<LF>" и после ", Last-modified"
  - находит в тексте начала заголовков (признаком заголовка является двойной
    символ LF) и заменяет их на <h>
  - находит в тексте концы параграфов (признаком конца параграфа является символ
    LF и последующий за ним отступ как минимум в 3 пробела) и заменяет их на <p>
  - заменяет все остальные переводы строки на пробелы
  - удаляет лишние пробелы
  - удаляет пробел из всех сочетаний "> "
  - восстанавливает параграфы, заменяя <p> на "<LF>     "
  - восстанавливает заголовки, заменяя <h> на "<LF><LF>     "
  - сжимает полученный текст в TCR
  Книга длиной 204 Кб конвертируется за 1 мин. 22 сек.

  Второй набор ("RTF change charset") исправляет ошибку, которую допускает
программа nConvert при переводе русских документов Word в RTF (точнее, ошибку
допускает MS Word, который эти RTF читает, но не в этом суть). Для того чтобы
такие RTF-файлы нормально отображались MS Word в них необходимо заменить все
вхождения fcharset0 на fcharset204. Это и делает данный набор (состоящий всего
из одного правила).

                               История изменений
                               -----------------
  Версия 1.10
  - Добавлена поддержка кодировки UTF-8
  - Длина всех задаваемых строк увеличена до 64 символов

  Версия 1.01 beta
  - Уменьшен объем памяти требуемый для сжатия в TCR.
  - Теперь программа использут фиксированный временный файл.

  Версия 1.00 beta
  - Начальная версия.

                                  Об авторе
                                  ---------
  Последнюю версии программы можно найти на www.hippo.ru/~tomin/TxtConv.html
  Замечания или предложения по поводу программы можно присылать на
tomin@samaramail.ru
